# B2.ASYMPTOTIC_RATE_CHECK (Stage A — Investigative Audit)

## Topology & Asymptotic Intent — B2.ASYMPTOTIC_RATE_CHECK
- **Definition & invocation:** Experiment defined in `src/capopm/experiments/audit_contracts.py:115-145` (contract) and implemented in `src/capopm/experiments/b2_asymptotic_rate_check.py` (not listed in supporting sources; *UNKNOWN exact file path/lines*). Runner-level handling uses generic `run_experiment` (`src/capopm/experiments/runner.py:49-335`) with B2-specific summary metrics embedded in `summary.json` (see `results/B2_asymptotic_rate__seed0/summary.json` where `sweep_params` includes `n_total_grid=[50,100,200]`).
- **Intended asymptotic regime:** The criterion references Theorem 7 (pooling/unraveling with large N traders). Asymptotic target appears to be behavior as total sample size `n_total` (effective trade count) grows, approximated by varying `n_total_grid` (50,100,200) in the scenario (`summary.json: status.metrics.rate_*`).
- **Variables to infinity:** Intended variable is total observation count/trade count `n_total` (effective sample size) per Theorem 7 (asymptotic unraveling with large N). Liquidity/arrivals are not swept here (UNKNOWN in absence of explicit b2 file).
- **Finite proxies used:** Finite grid of `n_total` values `[50,100,200]` (`results/B2_asymptotic_rate__seed0/summary.json:sweep_params`). Fits are performed via log-log regression on median variance/bias by `n_total` (per `summary.json` note: “Rate fits use log-log regression on median variance/bias by n_total.”).
- **Convergence rate operationalization:** Metrics `rate_var_vs_n_capopm`, `rate_bias_vs_n_capopm`, `rate_var_vs_n_uncorrected`, and `rate_var_slope_diff` stored in `summary.status.metrics` (`results/B2_asymptotic_rate__seed0/summary.json:status.metrics`). Slopes are compared to 0 with direction “<=” (contract).
- **Smoke tests touching convergence/rate:** Smoke test located at `smoke_test_b2_asymptotic_rate_check.py` (*not inspected; path assumed from naming*). Details of asserted behavior are UNKNOWN because the file has not been read; must be audited in Step 2 (below).

## Smoke Test Audit
- **smoke_test_b2_asymptotic_rate_check.py** — CONTENT UNKNOWN (file not inspected in provided sources). Assumed to exercise B2 rate logic; convergence assumptions and alignment with CAPOPM.pdf are UNKNOWN. This must be clarified to validate asymptotic claims.

## Criterion-Level Investigation

### bias_slope_negative — Scenario B2_asymptotic_rate__seed0 (FAIL)
- **Claim header:** Criterion `bias_slope_negative`; theorem `Theorem 7`; scenario `B2_asymptotic_rate__seed0`; metric `rate_bias_vs_n_capopm`.
- **Audit evidence (results/B2_asymptotic_rate__seed0/audit.json):** metric_path `["summary","status","metrics","rate_bias_vs_n_capopm"]`; comparator_path `null`; direction `<=`; threshold `0.0`; metric_value `0.4764176175417191`; evaluated `true`; pass `false`; reason `null`. Flags: none recorded; no semantics mismatch; no grid_missing_for_claim; coverage/calibration flags absent (not part of this criterion). Low_n_runs not flagged but only 3 grid points are used.
- **Backward trace:**  
  1) **audit_contracts.py:** Criterion defined at `src/capopm/experiments/audit_contracts.py:124-133` requiring bias slope vs n to be non-positive (Theorem 7).  
  2) **audit.py:** `_evaluate_criteria` resolves the metric path from `summary` and compares to threshold with `<=` (`src/capopm/experiments/audit.py:332-418`). No grid gating; evaluated=True.  
  3) **runner.py:** Generic aggregation does not compute rate metrics; they must be pre-populated in `summary` before audit. `summary.status.metrics.rate_bias_vs_n_capopm` is persisted by the B2 experiment logic (exact computation location UNKNOWN—likely in `b2_asymptotic_rate_check.py`).  
  4) **b2 experiment:** File not provided in supporting list; exact per-run construction of rate metrics is UNKNOWN. From `summary.json`, rate fits use log-log regression on median bias vs n_total grid (`summary.json: note`). Per-run metrics include `posterior_mean_bias` and `n_effective` for multiple runs at n_total∈{50,100,200}; rate_bias_vs_n_capopm likely derived from regression over these grouped values (exact code location UNKNOWN).  
  5) **Upstream modules:** Per-run bias and n_effective come from `runner.py` metrics computation (`runner.py:183-258` uses `posterior_mean_bias`, `posterior_variance`, `n_effective` from posterior moments). Simulator/likelihood/posterior paths are standard Phase 4+ corrections (`market_simulator.py:73-148`; `likelihood.py:33-43`; `posterior.py:28-135`; Stage1/Stage2 corrections as configured in B2—configuration specifics UNKNOWN without b2 file).
- **Paper alignment:** Theorem 7 (CAPOPM.pdf, pooling/non-pooling asymptotics) is about behavioral equilibria and unraveling with large N; it does not present a quantitative slope for posterior mean bias vs sample size. Mapping to a non-positive regression slope is an extrapolation not explicitly stated in the theorem. Criterion asserts more than the theorem provides.  
- **Finite-sample testability:** NO. Only three n_total points (50,100,200) yield a fragile log-log slope; regression over three points with high variance in bias is not a robust asymptotic test. The theorem is asymptotic in N→∞, so finite slope estimation from n_total≤200 is not a valid test of the asymptotic claim. Limitation: synthetic design (small grid) and claim overreach.  
- **Judgement calls & edge cases:** Slope fits over 3 points are highly noise-sensitive; “median bias” vs n_total grouping method unspecified; no CIs on slope; potential truncation if bias changes sign across n_total; rate uses `n_effective` per run but bins by configured n_total. Calibration fallback (equal_mass) indicates binning mode changes in aggregated metrics, though not directly used for rate.  
- **Fix proposal (documentation only):** To align with paper semantics, either (a) treat this as qualitative asymptotic trend and avoid hard thresholding at small n_total, or (b) increase grid/resamples and require CI on slope crossing 0. Alternatively, tie the claim to a derivation in Theorem 7 (if available) that specifies rate. Post-fix audit should not flag finite three-point slope as theorem failure without uncertainty bounds.

### variance_slope_negative — Scenario B2_asymptotic_rate__seed0 (PASS; not failed) — not investigated (not required).

### variance_improves_uncorrected — Scenario B2_asymptotic_rate__seed0 (PASS; not failed) — not investigated (not required).

## AUDIT SUMMARY
- Files inspected: results/paper_artifacts/claim_table.md; results/paper_artifacts/borderline_atlas.md; results/B2_asymptotic_rate__seed0/audit.json; results/B2_asymptotic_rate__seed0/summary.json; src/capopm/experiments/audit_contracts.py; src/capopm/experiments/audit.py; src/capopm/experiments/runner.py; src/capopm/likelihood.py; src/capopm/posterior.py; src/capopm/market_simulator.py; src/capopm/corrections/stage1_behavioral.py; src/capopm/corrections/stage2_structural.py; docs/CAPOPM_paper.pdf. (B2 experiment file and smoke test not found/inspected — UNKNOWN specifics.)
- Asymptotic targets identified: bias/variance behavior as n_total→∞ (Theorem 7 asymptotic pooling/unraveling context); operationalized via slopes over n_total grid {50,100,200}.
- Finite-sample violations: bias slope positive (0.476>0) over only three n_total points; not a reliable asymptotic test.
- Paper–audit mismatches: Theorem 7 does not state non-positive bias slope; audit extrapolates a quantitative rate claim. Asymptotic nature is tested with minimal finite grid.
- Unresolved ambiguities: Exact B2 implementation file/lines; precise computation of rate metrics; smoke test behavior for B2; how n_effective is tied to configured n_total; whether Stage1/Stage2 configurations differ across n_total.
- What I need next: Access to B2 implementation file (b2_asymptotic_rate_check.py) and smoke test to pin down rate computation and assumptions; confirmation of paper-backed rate claim (if any) before any Stage B planning. 
